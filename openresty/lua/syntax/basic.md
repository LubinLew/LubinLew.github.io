# 基础知识

本节介绍变量命名规则、操作符、字符串定义 和 注释等基础内容。

## 变量(variable/name/identifier)

Lua 变量的命名方式同C语言相同, 变量名只能有字母、数字 和 下划线组成，并且不能以数字开头。下面是不能用于变量名称的`保留关键字`：

| ------ | ------ | ------ | ------   | ------ |
| ------ | ------ | ------ | -------- | ------ |
| and    | break  | do     | else     |        |
| end    | false  | for    | function |        |
| in     | local  | nil    | not      |        |
| repeat | return | then   | true     | while  |
| ------ | ------ | ------ | ------   | ------ |

Lua 是大小写敏感的语言, 虽然`and` 是保留关键字,但是 And 和 AND 都是有效的变量名称。按照惯例，以下划线开头，大写字母（例如[`_VERSION`](http://www.lua.org/manual/5.1/manual.html#pdf-_VERSION)）开头的名称保留给Lua使用的内部全局变量。

### 变量的类型

Lua 中有下面8种数据类型

| 类型       | 释义   | 备注                 |
| -------- | ---- | ------------------ |
| nil      | 空    |                    |
| number   | 数值   |                    |
| string   | 字符串  |                    |
| boolean  | 布尔   | `true`/`false`     |
| table    | 表    | 数据结构               |
| function | 函数   |                    |
| thread   | 线程   |                    |
| userdata | 用户数据 | 将C语言的数据保存在Lua语言变量中 |

### 全局变量与局部变量

在Lua语言中全局变量无需声明即可使用, 使用未经过初始化的全局变量也不会导致错误。未经过初始化的全局变量其值为 `nil` 。

```lua
-- 定义全局变量 a
a = 10

-- 定义局部变量 b
local b = 20
```

注意在OpenResty环境中, 几乎所有的代码都试用局部变量, 因为使用全局变量会导致一些问题.详细见[HERE](https://wiki.jikexueyuan.com/project/openresty/ngx_lua/lua-variable-scope.html).

#### 局部变量的范围

| 定义位置 | 有效范围 |     |
| ---- | ---- | --- |
| 文件中  |      |     |
| 函数中  |      |     |
| 代码块中 |      |     |

---

## 操作符(operator)

下面是所有的操作符

| ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| `+`    | `-`    | `*`    | `/`    | `%`    | `^`    | `#`    |
| `==`   | `~=`   | `<=`   | `>=`   | `<`    | `>`    | `=`    |
| `(`    | `)`    | `{`    | `}`    | `[`    | `]`    |        |
| `;`    | `:`    | `,`    | `.`    | `..`   | `...`  |        |
| ------ | ------ | ------ | ------ | ------ | ------ | ------ |

---

## 字符串(string)

字符串是由一串字节序列组成，Lua不关系字节序列的编码方式(UTF8/UTF16等),所以Lua 字符串可以存储任意二进制数据。

Lua 中的字符串可以使用双引号 或者 单引号来界定, `"string"` 和 `'string'` 是完全相同的的字符串。其唯一的区别是使用双引号声明的字符串中出现单引号时，单引号不需要转义；使用单引号声明的字符串中出现双引号时，双引号不需要转义。实际编码过程中，尽量使用相同的声明方式，保持代码风格。

### 转义序列(escape sequence)

字符串中可以包含下面与C语言类似的转义序列:

| 转义序列   | 英文释义                                                            | 中文释义       | 补充说明                                              |
| ------ | --------------------------------------------------------------- | ---------- | ------------------------------------------------- |
| `\a`   | bell                                                            | 响铃         | 设备的蜂鸣器                                            |
| `\b`   | backspace                                                       | 退格         | 回退一个字符                                            |
| `\f`   | form feed                                                       | 换页         |                                                   |
| `\n`   | newline                                                         | 换行         |                                                   |
| `\r`   | carriage return                                                 | 回车         |                                                   |
| `\t`   | horizontal tab                                                  | 水平制表符      |                                                   |
| `\v`   | vertical tab                                                    | 垂直制表符      |                                                   |
| `\\`   | backslash                                                       | 反斜杠        |                                                   |
| `\"`   | quotation mark [double quote]                                   | 双引号        | 例子:`"key=\"value\""`<br>等价于`'key="value"'`        |
| `\'`   | apostrophe [single quote]                                       | 单引号        | 例子:`'key=\'value\''`<br>等价于`"key='value'"`        |
| `\ddd` | A character in a string can be specified by its numerical value | 使用数值表示一个字符 | 最多3个十进制数字,<br>如果该转义后紧跟数字那么必须使用3个十进制数的方式,否则会引起解析错误 |

> Lua5.2 开始支持 `\xHH` 十六进制,  例如 `\41` 等价于 0x41 即字母 A
> 
> Lua5.3 开始支持 `\u{h...h}` 的方式来声明UTF8字符,例如 `\u{3b1}` 即希腊字符 α (阿尔法)
> 
> Lua5.2 开始支持 `\z`转义符, 用来跳过其后的所有空白符,这样可以将长字符串分多行声明

### 长字符串声明

对于长字符串可以使用 `[[ ... ]]` 双方括号的方式来声明。

其中的转义字符不再生效。

多行字符串中的缩进、空格、换行等都会被保留。

如果多行字符串中的第一个字符是换行符时，那么这个换行符会被忽略。

```lua
long_str = [[
<html>
<head>
  <title>Long String</title>
<body>
  <h1>BODY</h1>
</head>
<\html>
]]
```

如果字符串中有`[[`或者`]]` 字符时，会破坏声明，这时候需要使用`[=[ ... ]=]` 这种方式声明，注意其中`=`等号的个数是任意的, 但是前后等号的个数必须是相同的。

`[==[ ...  ]==]` 或者 `[===[ ... ]===]` 等都是正确的声明方式。

```lua
long_str = [===[
example1:[[A]]
example2:[=[B]=]
example3:[==[C]==]
]===]
```

----

## 语句

Lua 的语句之间的分隔符不是必须的, 如果有需要可以使用`;`分号来分隔

```lua
a = 1

b = 2  c = 3 -- 语句正确
b = 2; c = 3 -- 这样使用分隔符,可读性会更好一些
```

所以在同一行中写多条语句的时候才需要使用分隔符,当然目的只是可读性更好

----

## 注释

Lua 的注释方式与其他语言都不同。

### 单行注释

单行注释使用 `--` 来声明

```lua
-- single line comment
local str = 'example' -- this is string declaration
```

### 多行注释

多行注释使用 `--[[  --]]` 的方式

```lua
--[[
这是一个
多行的
注释
--]]
```

如果注释中出现会破坏注释的字符, 方法同长字符串声明的方式相同, 在两个方括号中间加入任意个`=` 等号

```lua
local num = 1
--[===[
--[[ 这样就不会破坏原来的多行注释了
--]] 同上
--]===]
local str = 'string'
```

---
